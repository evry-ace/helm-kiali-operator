# Kiali Operator Helm Chart

[kiali-operator][kiali-operator] simplifies Kiali installation, configuration
and management.

[kiali-operator]: https://github.com/kiali/kiali/tree/master/operator/

## Introduction

This chart installs the Kiali Operator and required Custom Resource Definitions
(CRDs).

## Official Documentation

Official project documentation found [here][kiali-operator].

## Prerequisites

- Kubernetes 1.4+ with Beta APIs enabled

## Installing the Chart

To install the chart with the release name `kiali-operator` in the
`kiali-system` namespace:

```bash
$ helm install evry-ace/kiali-operator --name kiali-operator --namespace kiali-system
```

## Uninstalling the Chart

To uninstall/delete the `kiali-operator` release:

```bash
$ helm delete --purge kiali-operator
```

## Updating

Once you have a new chart version, you can update your deployment with:

```
$ helm upgrade kiali-operator stable/kiali-operator
```

## Configuration

The following table lists the configurable parameters of the kiali-operator chart and their default values.

| Parameter                | Description                                                          | Default                                        |
| ------------------------ | -------------------------------------------------------------------- | ---------------------------------------------- |
| `crd.create`             | Create a custom resource for Kiali Operator                          | `true`                                         |
| `rbac.create`            | Install required RBAC service account, roles and rolebindings        | `true`                                         |
| `serviceAccount.create`  | Flag to create the service account                                   | `true`                                         |
| `serviceAccount.name`    | Name of the service account resource when RBAC is enabled            | (autogenerated)                                |
| `clusterWide`            | Deploy Kiali Operator cluster wide                                   | default `true`                                 |
| `nameOverride`           | Kiali Operator name override                                         | ``                                             |
| `nameOverride`           | Kiali Operator full name override                                    | ``                                             |
| `replicaCount`           | Number of operator replicas to create (only 1 is supported)          | `1`                                            |
| `image.repository`       | kiali-operator container image                                       | `quay.io/kiali/kiali-operator`                 |
| `image.tag`              | kiali-operator container image tag                                   | `v1.7.0`                                       |
| `image.pullpolicy`       | kiali-operator container image pull policy                           | `Always`                                       |
| `imagePullSecrets`       | kiali-operator contianer image pull secrets                          | `[]`                                           |
| `resources`              | CPU limit per kiali-operator pod                                     | `100m`                                         |
| `podSecurityContext`     | PodSecurityContext for Kiali Operator                                | `{}`                                           |
| `securityContext`        | SecurityContext for Kiali Operator                                   | `{}`                                           |
| `nodeSelector`           | Node labels for Kiali Operator pod assignment                        | `{}`                                           |
| `podAnnotations`         | Annotations for the Kiali Operator pod                               | `{}`                                           |
| `affinity`               | Annotations for the Kiali Operator pod                               | `{}`                                           |

Specify each parameter using the `--set key=value[,key=value]` argument to `helm install`. For example:

```bash
$ helm install --name kiali-operator --set image.tag=v1.7.0 stable/kiali-operator
```

Alternatively, a YAML file that specifies the values for the parameters can be provided while
installing the chart. For example:

```bash
$ helm install --name kiali-operator --values values.yaml stable/kiali-operator
```

## RBAC
By default the chart will install the recommended RBAC roles and rolebindings.

To determine if your cluster supports this running the following:

```console
$ kubectl api-versions | grep rbac
```

You also need to have the following parameter on the api server. See the following document for how to enable [RBAC](https://kubernetes.io/docs/admin/authorization/rbac/)

```
--authorization-mode=RBAC
```

If the output contains "beta" or both "alpha" and "beta" you can may install rbac by default, if not, you may turn RBAC off as described below.

### RBAC role/rolebinding creation

RBAC resources are enabled by default. To disable RBAC do the following:

```console
$ helm install --name kiali-operator stable/kiali-operator --set rbac.create=false
```
